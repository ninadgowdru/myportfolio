<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>CORS PoC</title>
  <style>
    body{font-family:system-ui,Arial;padding:1rem;line-height:1.4}
    pre{white-space:pre-wrap;border:1px solid #ddd;padding:1rem;background:#f9f9f9}
    code{background:#f3f3f3;padding:.1rem .3rem;border-radius:3px}
  </style>
</head>
<body>
  <h2>CORS PoC â€” open DevTools Console & Network</h2>
  <p><strong>Endpoint:</strong> <span id="ep"></span></p>
  <p id="status">Running PoC fetch...</p>
  <pre id="out">waiting...</pre>

<script>
/*
  EDIT THESE VALUES:
  - ENDPOINT: the URL you want to test (e.g. https://status.cloud.google.com/incidents.json)
  - CREDENTIALS: 'omit' for public endpoints, 'include' to test credentialed requests (ONLY if in-scope and permitted)
  - MODE: 'cors' is standard; 'no-cors' will not allow reading response and is not useful for PoC
*/
const ENDPOINT = 'https://status.cloud.google.com/incidents.json';
const CREDENTIALS = 'omit'; // 'omit' | 'include' | 'same-origin'
const MODE = 'cors';

document.getElementById('ep').innerText = ENDPOINT;

(async () => {
  try {
    const t0 = Date.now();
    const resp = await fetch(ENDPOINT, { method: 'GET', mode: MODE, credentials: CREDENTIALS });
    const t1 = Date.now();
    document.getElementById('status').innerText = `Request status: ${resp.status} (time: ${t1 - t0} ms)`;

    // Headers snapshot
    const headers = {};
    resp.headers.forEach((v,k) => headers[k] = v);
    const hdrSummary = [
      'access-control-allow-origin: ' + (headers['access-control-allow-origin'] || 'Not Present'),
      'access-control-allow-credentials: ' + (headers['access-control-allow-credentials'] || 'Not Present'),
      'vary: ' + (headers['vary'] || 'Not Present')
    ].join('\\n');

    // Try to parse as JSON if possible
    const ct = resp.headers.get('content-type') || '';
    let bodyPreview = '';
    try {
      if (ct.includes('json')) {
        const j = await resp.json();
        bodyPreview = JSON.stringify(j, null, 2).slice(0, 20000);
      } else {
        const t = await resp.text();
        bodyPreview = t.slice(0, 20000);
      }
    } catch (e) {
      bodyPreview = 'Error parsing response body: ' + e;
    }

    document.getElementById('out').innerText = [
      '=== Response headers summary ===',
      hdrSummary,
      '',
      '=== Body (preview, first 20k chars) ===',
      bodyPreview
    ].join('\\n\\n');

    console.log('CORS PoC result', { status: resp.status, headers, bodyPreview });
  } catch (err) {
    document.getElementById('status').innerText = 'Fetch failed: ' + err;
    document.getElementById('out').innerText = 'fetch error: ' + err;
    console.error('fetch error', err);
  }
})();
</script>
</body>
</html>
